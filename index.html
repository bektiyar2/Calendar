<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ä–µ–¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        .modal.active { display: flex; }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loading" class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full spin mx-auto mb-4"></div>
            <p class="text-xl text-gray-700">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="app" class="p-4 md:p-8" style="display: none;">
        <div class="max-w-6xl mx-auto">
            
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <h1 class="text-3xl font-bold text-gray-800">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
                    </div>
                    <div class="text-sm text-gray-500">
                        <span id="participantCount">0</span> —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                
                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
                <div class="md:col-span-2">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            –°—Ä–µ–¥—ã –Ω–∞ –º–µ—Å—è—Ü –≤–ø–µ—Ä—ë–¥
                        </h2>
                        <div id="calendar" class="space-y-3"></div>
                    </div>
                </div>

                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="space-y-6">
                    
                    <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞
                        </h2>
                        <div id="reminders"></div>
                    </div>

                    <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                –£—á–∞—Å—Ç–Ω–∏–∫–∏
                            </h2>
                            <button onclick="openParticipantsModal()" class="p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                        </div>
                        <div id="participantsList" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="bookingModal" class="modal">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—É</h3>
            <div class="mb-4">
                <p class="text-gray-600 mb-2">–î–∞—Ç–∞:</p>
                <p id="bookingDate" class="text-lg font-semibold text-indigo-600"></p>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 mb-2 font-medium">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞:</label>
                <select id="participantSelect" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                </select>
            </div>
            <div class="flex gap-3">
                <button onclick="confirmBooking()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                    –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button onclick="closeBookingModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ -->
    <div id="participantsModal" class="modal">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl w-full my-8 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
                </h3>
                <button onclick="closeParticipantsModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="bg-indigo-50 rounded-xl p-4 mb-6">
                <h4 class="font-semibold text-gray-800 mb-3" id="formTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h4>
                <div class="space-y-3">
                    <input type="text" id="participantName" placeholder="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                    <input type="tel" id="participantPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, +7 900 000-00-00)" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                    <div id="formButtons"></div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
            <div class="space-y-2">
                <h4 class="font-semibold text-gray-800 mb-2">
                    –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (<span id="totalParticipants">0</span>)
                </h4>
                <div id="participantsManageList" class="space-y-2"></div>
            </div>

            <div class="mt-6">
                <button onclick="closeParticipantsModal()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        let bookings = [];
        let participants = [];
        let selectedDate = null;
        let editingParticipant = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            try {
                await loadData();
                renderApp();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                document.getElementById('loading').innerHTML = '<p class="text-red-600">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                const bookingsResult = await window.storage.get('bookings', true);
                if (bookingsResult) {
                    bookings = JSON.parse(bookingsResult.value);
                }
            } catch (error) {
                console.log('–î–∞–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            }

            try {
                const participantsResult = await window.storage.get('participants', true);
                if (participantsResult) {
                    participants = JSON.parse(participantsResult.value);
                } else {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    participants = [];
                    for (let i = 1; i <= 15; i++) {
                        participants.push({
                            id: i,
                            name: `–£—á–∞—Å—Ç–Ω–∏–∫ ${i}`,
                            phone: `+7 900 000-00-${String(i).padStart(2, '0')}`
                        });
                    }
                    await saveParticipants();
                }
            } catch (error) {
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤');
                participants = [];
                for (let i = 1; i <= 15; i++) {
                    participants.push({
                        id: i,
                        name: `–£—á–∞—Å—Ç–Ω–∏–∫ ${i}`,
                        phone: `+7 900 000-00-${String(i).padStart(2, '0')}`
                    });
                }
                await saveParticipants();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        async function saveBookings() {
            await window.storage.set('bookings', JSON.stringify(bookings), true);
        }

        async function saveParticipants() {
            await window.storage.set('participants', JSON.stringify(participants), true);
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥—ã
        function getWednesdays() {
            const wednesdays = [];
            const today = new Date();
            const endDate = new Date(today);
            endDate.setMonth(endDate.getMonth() + 1);

            let current = new Date(today);
            while (current.getDay() !== 3) {
                current.setDate(current.getDate() + 1);
            }

            while (current <= endDate) {
                wednesdays.push(new Date(current));
                current.setDate(current.getDate() + 7);
            }

            return wednesdays;
        }

        function formatDate(date) {
            return date.toLocaleDateString('ru-RU', { 
                day: 'numeric', 
                month: 'long',
                year: 'numeric'
            });
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function isBooked(date) {
            const dateKey = getDateKey(date);
            return bookings.find(b => b.date === dateKey);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function renderApp() {
            renderCalendar();
            renderReminders();
            renderParticipantsList();
            document.getElementById('participantCount').textContent = participants.length;
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const wednesdays = getWednesdays();
            const today = new Date();

            calendar.innerHTML = wednesdays.map(wednesday => {
                const booking = isBooked(wednesday);
                const isPast = wednesday < today;
                const dateKey = getDateKey(wednesday);

                let bgClass, borderClass, textClass, clickable;
                if (booking) {
                    bgClass = 'bg-red-50';
                    borderClass = 'border-red-200';
                    textClass = 'text-red-600';
                    clickable = '';
                } else if (isPast) {
                    bgClass = 'bg-gray-50';
                    borderClass = 'border-gray-200';
                    textClass = 'text-gray-500';
                    clickable = 'opacity-50';
                } else {
                    bgClass = 'bg-green-50';
                    borderClass = 'border-green-200 hover:border-green-400';
                    textClass = 'text-green-600';
                    clickable = 'cursor-pointer';
                }

                return `
                    <div class="p-4 rounded-xl border-2 transition-all ${bgClass} ${borderClass} ${clickable}"
                         onclick="${!booking && !isPast ? `openBookingModal('${dateKey}')` : ''}">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">${formatDate(wednesday)}</p>
                                ${booking ? `<p class="text-sm ${textClass} mt-1">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ: ${booking.participantName}</p>` : 
                                   isPast ? `<p class="text-sm ${textClass} mt-1">–ü—Ä–æ—à–µ–¥—à–∞—è –¥–∞—Ç–∞</p>` :
                                   `<p class="text-sm ${textClass} mt-1">–°–≤–æ–±–æ–¥–Ω–æ</p>`}
                            </div>
                            ${booking ? `
                                <button onclick="event.stopPropagation(); deleteBooking(${booking.id})" 
                                        class="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderReminders() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowKey = getDateKey(tomorrow);
            const reminders = bookings.filter(b => b.date === tomorrowKey);

            const container = document.getElementById('reminders');

            if (reminders.length > 0) {
                container.innerHTML = `
                    <p class="text-sm text-gray-600 mb-3">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —ç—Ç–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º:</p>
                    ${reminders.map(reminder => `
                        <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-200 mb-2">
                            <p class="font-semibold text-gray-800">${reminder.participantName}</p>
                            <p class="text-sm text-gray-600">${reminder.participantPhone}</p>
                            <p class="text-xs text-gray-500 mt-1">${new Date(reminder.date).toLocaleDateString('ru-RU')}</p>
                        </div>
                    `).join('')}
                    <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="text-sm text-gray-700 font-medium mb-2">–¢–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:</p>
                        <p class="text-sm text-gray-600 italic">"–ù–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –∑–∞–≤—Ç—Ä–∞ –≤–∞—à–∞ —Å—Ä–µ–¥–∞! –ñ–¥—ë–º –≤–∞—Å üòä"</p>
                    </div>
                `;
            } else {
                container.innerHTML = '<p class="text-gray-500 text-sm">–ù–∞ –∑–∞–≤—Ç—Ä–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>';
            }
        }

        function renderParticipantsList() {
            const container = document.getElementById('participantsList');
            container.innerHTML = participants.map(participant => {
                const bookingCount = bookings.filter(b => b.participantId === participant.id).length;
                return `
                    <div class="p-2 hover:bg-gray-50 rounded-lg">
                        <p class="text-sm font-medium text-gray-800">${participant.name}</p>
                        <p class="text-xs text-gray-500">${participant.phone}</p>
                        <p class="text-xs text-indigo-600 mt-1">–ë—Ä–æ–Ω–µ–π: ${bookingCount}</p>
                    </div>
                `;
            }).join('');
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function openBookingModal(dateKey) {
            selectedDate = dateKey;
            const date = new Date(dateKey + 'T00:00:00');
            document.getElementById('bookingDate').textContent = formatDate(date);
            
            const select = document.getElementById('participantSelect');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>' + 
                participants.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            
            document.getElementById('bookingModal').classList.add('active');
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
            selectedDate = null;
        }

        async function confirmBooking() {
            const participantId = parseInt(document.getElementById('participantSelect').value);
            if (!participantId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞');
                return;
            }

            const participant = participants.find(p => p.id === participantId);
            if (isBooked(new Date(selectedDate + 'T00:00:00'))) {
                alert('–≠—Ç–∞ –¥–∞—Ç–∞ —É–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞');
                return;
            }

            const newBooking = {
                id: Date.now(),
                date: selectedDate,
                participantId: participant.id,
                participantName: participant.name,
                participantPhone: participant.phone,
                createdAt: new Date().toISOString()
            };

            bookings.push(newBooking);
            await saveBookings();
            closeBookingModal();
            renderApp();
        }

        async function deleteBooking(bookingId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')) {
                bookings = bookings.filter(b => b.id !== bookingId);
                await saveBookings();
                renderApp();
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
        function openParticipantsModal() {
            editingParticipant = null;
            document.getElementById('participantName').value = '';
            document.getElementById('participantPhone').value = '';
            updateParticipantsForm();
            renderParticipantsManageList();
            document.getElementById('participantsModal').classList.add('active');
        }

        function closeParticipantsModal() {
            document.getElementById('participantsModal').classList.remove('active');
            editingParticipant = null;
            renderApp();
        }

        function updateParticipantsForm() {
            const formTitle = document.getElementById('formTitle');
            const formButtons = document.getElementById('formButtons');

            if (editingParticipant) {
                formTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞';
                formButtons.innerHTML = `
                    <div class="flex gap-2">
                        <button onclick="updateParticipant()" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                        <button onclick="cancelEdit()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                `;
            } else {
                formTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞';
                formButtons.innerHTML = `
                    <button onclick="addParticipant()" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
                    </button>
                `;
            }
        }

        async function addParticipant() {
            const name = document.getElementById('participantName').value.trim();
            const phone = document.getElementById('participantPhone').value.trim();

            if (!name || !phone) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }

            const newParticipant = {
                id: Date.now(),
                name: name,
                phone: phone
            };

            participants.push(newParticipant);
            await saveParticipants();

            document.getElementById('participantName').value = '';
            document.getElementById('participantPhone').value = '';
            renderParticipantsManageList();
        }

        function startEditParticipant(participantId) {
            editingParticipant = participants.find(p => p.id === participantId);
            document.getElementById('participantName').value = editingParticipant.name;
            document.getElementById('participantPhone').value = editingParticipant.phone;
            updateParticipantsForm();
        }

        async function updateParticipant() {
            const name = document.getElementById('participantName').value.trim();
            const phone = document.getElementById('participantPhone').value.trim();

            if (!name || !phone) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }

            participants = participants.map(p => 
                p.id === editingParticipant.id 
                    ? { ...p, name: name, phone: phone }
                    : p
            );

            bookings = bookings.map(b => 
                b.participantId === editingParticipant.id
                    ? { ...b, participantName: name, participantPhone: phone }
                    : b
            );

            await saveParticipants();
            await saveBookings();

            editingParticipant = null;
            document.getElementById('participantName').value = '';
            document.getElementById('participantPhone').value = '';
            updateParticipantsForm();
            renderParticipantsManageList();
        }

        function cancelEdit() {
            editingParticipant = null;
            document.getElementById('participantName').value = '';
            document.getElementById('participantPhone').value = '';
            updateParticipantsForm();
        }

        async function deleteParticipant(participantId) {
            const hasBookings = bookings.some(b => b.participantId === participantId);

            if (hasBookings) {
                alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏. –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –±—Ä–æ–Ω–∏.');
                return;
            }

            if (confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞?')) {
                participants = participants.filter(p => p.id !== participantId);
                await saveParticipants();
                renderParticipantsManageList();
            }
        }

        function renderParticipantsManageList() {
            const container = document.getElementById('participantsManageList');
            document.getElementById('totalParticipants').textContent = participants.length;

            container.innerHTML = participants.map(participant => {
                const bookingCount = bookings.filter(b => b.participantId === participant.id).length;
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">${participant.name}</p>
                            <p class="text-sm text-gray-600">${participant.phone}</p>
                            <p class="text-xs text-indigo-600 mt-1">–ê–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π: ${bookingCount}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="startEditParticipant(${participant.id})" class="p-2 text-indigo-600 hover:bg-indigo-100 rounded-lg transition-colors" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteParticipant(${participant.id})" class="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors" title="–£–¥–∞–ª–∏—Ç—å">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>