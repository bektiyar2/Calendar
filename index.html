import React, { useState, useEffect } from 'react';
import { Calendar, Users, Bell, Trash2, Plus, Clock, Edit, X } from 'lucide-react';

const WednesdayBookingCalendar = () => {
  const [bookings, setBookings] = useState([]);
  const [participants, setParticipants] = useState([
    { id: 1, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 1', phone: '+7 900 000-00-01' },
    { id: 2, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 2', phone: '+7 900 000-00-02' },
    { id: 3, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 3', phone: '+7 900 000-00-03' },
    { id: 4, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 4', phone: '+7 900 000-00-04' },
    { id: 5, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 5', phone: '+7 900 000-00-05' },
    { id: 6, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 6', phone: '+7 900 000-00-06' },
    { id: 7, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 7', phone: '+7 900 000-00-07' },
    { id: 8, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 8', phone: '+7 900 000-00-08' },
    { id: 9, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 9', phone: '+7 900 000-00-09' },
    { id: 10, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 10', phone: '+7 900 000-00-10' },
    { id: 11, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 11', phone: '+7 900 000-00-11' },
    { id: 12, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 12', phone: '+7 900 000-00-12' },
    { id: 13, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 13', phone: '+7 900 000-00-13' },
    { id: 14, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 14', phone: '+7 900 000-00-14' },
    { id: 15, name: '–£—á–∞—Å—Ç–Ω–∏–∫ 15', phone: '+7 900 000-00-15' },
  ]);
  const [loading, setLoading] = useState(true);
  const [selectedDate, setSelectedDate] = useState(null);
  const [selectedParticipant, setSelectedParticipant] = useState('');
  const [showBookingModal, setShowBookingModal] = useState(false);
  const [showParticipantsModal, setShowParticipantsModal] = useState(false);
  const [editingParticipant, setEditingParticipant] = useState(null);
  const [newParticipantName, setNewParticipantName] = useState('');
  const [newParticipantPhone, setNewParticipantPhone] = useState('');

  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    try {
      setLoading(true);
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      const bookingsResult = await window.storage.get('bookings', true);
      if (bookingsResult) {
        setBookings(JSON.parse(bookingsResult.value));
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
      const participantsResult = await window.storage.get('participants', true);
      if (participantsResult) {
        setParticipants(JSON.parse(participantsResult.value));
      }
    } catch (error) {
      console.log('–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
    } finally {
      setLoading(false);
    }
  };

  const saveBookings = async (newBookings) => {
    try {
      await window.storage.set('bookings', JSON.stringify(newBookings), true);
      setBookings(newBookings);
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
    }
  };

  const saveParticipants = async (newParticipants) => {
    try {
      await window.storage.set('participants', JSON.stringify(newParticipants), true);
      setParticipants(newParticipants);
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', error);
    }
  };

  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—Ä–µ–¥—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
  const getWednesdays = () => {
    const wednesdays = [];
    const today = new Date();
    const endDate = new Date(today);
    endDate.setMonth(endDate.getMonth() + 1);

    let current = new Date(today);
    
    // –ù–∞–π—Ç–∏ –ø–µ—Ä–≤—É—é —Å—Ä–µ–¥—É
    while (current.getDay() !== 3) {
      current.setDate(current.getDate() + 1);
    }

    // –°–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å—Ä–µ–¥—ã –¥–æ –∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞
    while (current <= endDate) {
      wednesdays.push(new Date(current));
      current.setDate(current.getDate() + 7);
    }

    return wednesdays;
  };

  const formatDate = (date) => {
    return date.toLocaleDateString('ru-RU', { 
      day: 'numeric', 
      month: 'long',
      year: 'numeric'
    });
  };

  const getDateKey = (date) => {
    return date.toISOString().split('T')[0];
  };

  const isBooked = (date) => {
    const dateKey = getDateKey(date);
    return bookings.find(b => b.date === dateKey);
  };

  const addBooking = async () => {
    if (!selectedDate || !selectedParticipant) {
      alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞');
      return;
    }

    const dateKey = getDateKey(selectedDate);
    const participant = participants.find(p => p.id === parseInt(selectedParticipant));
    
    if (isBooked(selectedDate)) {
      alert('–≠—Ç–∞ –¥–∞—Ç–∞ —É–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞');
      return;
    }

    const newBooking = {
      id: Date.now(),
      date: dateKey,
      participantId: participant.id,
      participantName: participant.name,
      participantPhone: participant.phone,
      createdAt: new Date().toISOString()
    };

    await saveBookings([...bookings, newBooking]);
    setShowBookingModal(false);
    setSelectedDate(null);
    setSelectedParticipant('');
  };

  const deleteBooking = async (bookingId) => {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')) {
      const newBookings = bookings.filter(b => b.id !== bookingId);
      await saveBookings(newBookings);
    }
  };

  const getReminders = () => {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const tomorrowKey = getDateKey(tomorrow);

    return bookings.filter(b => b.date === tomorrowKey);
  };

  const addParticipant = async () => {
    if (!newParticipantName.trim() || !newParticipantPhone.trim()) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
      return;
    }

    const newParticipant = {
      id: Date.now(),
      name: newParticipantName.trim(),
      phone: newParticipantPhone.trim()
    };

    const newParticipants = [...participants, newParticipant];
    await saveParticipants(newParticipants);
    setNewParticipantName('');
    setNewParticipantPhone('');
  };

  const updateParticipant = async () => {
    if (!newParticipantName.trim() || !newParticipantPhone.trim()) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
      return;
    }

    const newParticipants = participants.map(p => 
      p.id === editingParticipant.id 
        ? { ...p, name: newParticipantName.trim(), phone: newParticipantPhone.trim() }
        : p
    );

    await saveParticipants(newParticipants);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
    const updatedBookings = bookings.map(b => 
      b.participantId === editingParticipant.id
        ? { ...b, participantName: newParticipantName.trim(), participantPhone: newParticipantPhone.trim() }
        : b
    );
    await saveBookings(updatedBookings);

    setEditingParticipant(null);
    setNewParticipantName('');
    setNewParticipantPhone('');
  };

  const deleteParticipant = async (participantId) => {
    const hasBookings = bookings.some(b => b.participantId === participantId);
    
    if (hasBookings) {
      alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏. –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –±—Ä–æ–Ω–∏.');
      return;
    }

    if (confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞?')) {
      const newParticipants = participants.filter(p => p.id !== participantId);
      await saveParticipants(newParticipants);
    }
  };

  const startEditParticipant = (participant) => {
    setEditingParticipant(participant);
    setNewParticipantName(participant.name);
    setNewParticipantPhone(participant.phone);
  };

  const wednesdays = getWednesdays();
  const reminders = getReminders();

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
        <div className="text-center">
          <Clock className="w-16 h-16 text-indigo-600 animate-spin mx-auto mb-4" />
          <p className="text-xl text-gray-700">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Calendar className="w-8 h-8 text-indigo-600" />
              <h1 className="text-3xl font-bold text-gray-800">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
            </div>
            <div className="text-sm text-gray-500">
              {participants.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            </div>
          </div>
        </div>

        <div className="grid md:grid-cols-3 gap-6">
          {/* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */}
          <div className="md:col-span-2">
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <Calendar className="w-5 h-5" />
                –°—Ä–µ–¥—ã –Ω–∞ –º–µ—Å—è—Ü –≤–ø–µ—Ä—ë–¥
              </h2>
              
              <div className="space-y-3">
                {wednesdays.map((wednesday, index) => {
                  const booking = isBooked(wednesday);
                  const isPast = wednesday < new Date();
                  
                  return (
                    <div
                      key={index}
                      className={`p-4 rounded-xl border-2 transition-all ${
                        booking
                          ? 'bg-red-50 border-red-200'
                          : isPast
                          ? 'bg-gray-50 border-gray-200 opacity-50'
                          : 'bg-green-50 border-green-200 hover:border-green-400 cursor-pointer'
                      }`}
                      onClick={() => {
                        if (!booking && !isPast) {
                          setSelectedDate(wednesday);
                          setShowBookingModal(true);
                        }
                      }}
                    >
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-semibold text-gray-800">
                            {formatDate(wednesday)}
                          </p>
                          {booking ? (
                            <p className="text-sm text-red-600 mt-1">
                              –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ: {booking.participantName}
                            </p>
                          ) : isPast ? (
                            <p className="text-sm text-gray-500 mt-1">–ü—Ä–æ—à–µ–¥—à–∞—è –¥–∞—Ç–∞</p>
                          ) : (
                            <p className="text-sm text-green-600 mt-1">–°–≤–æ–±–æ–¥–Ω–æ</p>
                          )}
                        </div>
                        
                        {booking && (
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              deleteBooking(booking.id);
                            }}
                            className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors"
                          >
                            <Trash2 className="w-5 h-5" />
                          </button>
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */}
          <div className="space-y-6">
            {/* –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è */}
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <Bell className="w-5 h-5" />
                –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞
              </h2>
              
              {reminders.length > 0 ? (
                <div className="space-y-3">
                  <p className="text-sm text-gray-600 mb-3">
                    –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —ç—Ç–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º:
                  </p>
                  {reminders.map((reminder) => (
                    <div key={reminder.id} className="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                      <p className="font-semibold text-gray-800">{reminder.participantName}</p>
                      <p className="text-sm text-gray-600">{reminder.participantPhone}</p>
                      <p className="text-xs text-gray-500 mt-1">
                        {new Date(reminder.date).toLocaleDateString('ru-RU')}
                      </p>
                    </div>
                  ))}
                  
                  <div className="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <p className="text-sm text-gray-700 font-medium mb-2">–¢–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:</p>
                    <p className="text-sm text-gray-600 italic">
                      "–ù–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –∑–∞–≤—Ç—Ä–∞ –≤–∞—à–∞ —Å—Ä–µ–¥–∞! –ñ–¥—ë–º –≤–∞—Å üòä"
                    </p>
                  </div>
                </div>
              ) : (
                <p className="text-gray-500 text-sm">–ù–∞ –∑–∞–≤—Ç—Ä–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>
              )}
            </div>

            {/* –£—á–∞—Å—Ç–Ω–∏–∫–∏ */}
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                  <Users className="w-5 h-5" />
                  –£—á–∞—Å—Ç–Ω–∏–∫–∏
                </h2>
                <button
                  onClick={() => setShowParticipantsModal(true)}
                  className="p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                  title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏"
                >
                  <Edit className="w-4 h-4" />
                </button>
              </div>
              
              <div className="space-y-2 max-h-64 overflow-y-auto">
                {participants.map((participant) => {
                  const bookingCount = bookings.filter(b => b.participantId === participant.id).length;
                  return (
                    <div key={participant.id} className="p-2 hover:bg-gray-50 rounded-lg">
                      <p className="text-sm font-medium text-gray-800">{participant.name}</p>
                      <p className="text-xs text-gray-500">{participant.phone}</p>
                      <p className="text-xs text-indigo-600 mt-1">
                        –ë—Ä–æ–Ω–µ–π: {bookingCount}
                      </p>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>

        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */}
        {showBookingModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full">
              <h3 className="text-2xl font-bold text-gray-800 mb-4">
                –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—É
              </h3>
              
              <div className="mb-4">
                <p className="text-gray-600 mb-2">–î–∞—Ç–∞:</p>
                <p className="text-lg font-semibold text-indigo-600">
                  {selectedDate && formatDate(selectedDate)}
                </p>
              </div>

              <div className="mb-6">
                <label className="block text-gray-700 mb-2 font-medium">
                  –í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞:
                </label>
                <select
                  value={selectedParticipant}
                  onChange={(e) => setSelectedParticipant(e.target.value)}
                  className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                >
                  <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                  {participants.map((p) => (
                    <option key={p.id} value={p.id}>
                      {p.name}
                    </option>
                  ))}
                </select>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={addBooking}
                  className="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                >
                  <Plus className="w-5 h-5" />
                  –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button
                  onClick={() => {
                    setShowBookingModal(false);
                    setSelectedDate(null);
                    setSelectedParticipant('');
                  }}
                  className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                >
                  –û—Ç–º–µ–Ω–∞
                </button>
              </div>
            </div>
          </div>
        )}

        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ */}
        {showParticipantsModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
            <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl w-full my-8">
              <div className="flex items-center justify-between mb-6">
                <h3 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                  <Users className="w-6 h-6" />
                  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
                </h3>
                <button
                  onClick={() => {
                    setShowParticipantsModal(false);
                    setEditingParticipant(null);
                    setNewParticipantName('');
                    setNewParticipantPhone('');
                  }}
                  className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                >
                  <X className="w-6 h-6 text-gray-600" />
                </button>
              </div>

              {/* –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */}
              <div className="bg-indigo-50 rounded-xl p-4 mb-6">
                <h4 className="font-semibold text-gray-800 mb-3">
                  {editingParticipant ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞' : '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞'}
                </h4>
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞"
                    value={newParticipantName}
                    onChange={(e) => setNewParticipantName(e.target.value)}
                    className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                  />
                  <input
                    type="tel"
                    placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, +7 900 000-00-00)"
                    value={newParticipantPhone}
                    onChange={(e) => setNewParticipantPhone(e.target.value)}
                    className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                  />
                  <div className="flex gap-2">
                    {editingParticipant ? (
                      <>
                        <button
                          onClick={updateParticipant}
                          className="flex-1 bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                        >
                          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                        <button
                          onClick={() => {
                            setEditingParticipant(null);
                            setNewParticipantName('');
                            setNewParticipantPhone('');
                          }}
                          className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                        >
                          –û—Ç–º–µ–Ω–∞
                        </button>
                      </>
                    ) : (
                      <button
                        onClick={addParticipant}
                        className="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                      >
                        <Plus className="w-5 h-5" />
                        –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
                      </button>
                    )}
                  </div>
                </div>
              </div>

              {/* –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */}
              <div className="space-y-2 max-h-96 overflow-y-auto">
                <h4 className="font-semibold text-gray-800 mb-2">
                  –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ({participants.length})
                </h4>
                {participants.map((participant) => {
                  const bookingCount = bookings.filter(b => b.participantId === participant.id).length;
                  return (
                    <div
                      key={participant.id}
                      className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
                    >
                      <div className="flex-1">
                        <p className="font-medium text-gray-800">{participant.name}</p>
                        <p className="text-sm text-gray-600">{participant.phone}</p>
                        <p className="text-xs text-indigo-600 mt-1">
                          –ê–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π: {bookingCount}
                        </p>
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => startEditParticipant(participant)}
                          className="p-2 text-indigo-600 hover:bg-indigo-100 rounded-lg transition-colors"
                          title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                        >
                          <Edit className="w-5 h-5" />
                        </button>
                        <button
                          onClick={() => deleteParticipant(participant.id)}
                          className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors"
                          title="–£–¥–∞–ª–∏—Ç—å"
                        >
                          <Trash2 className="w-5 h-5" />
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>

              <div className="mt-6">
                <button
                  onClick={() => {
                    setShowParticipantsModal(false);
                    setEditingParticipant(null);
                    setNewParticipantName('');
                    setNewParticipantPhone('');
                  }}
                  className="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                >
                  –ó–∞–∫—Ä—ã—Ç—å
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default WednesdayBookingCalendar;
